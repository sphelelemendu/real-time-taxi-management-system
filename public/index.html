<!DOCTYPE html>
<html lang="en">

<head>
  <title>Taxi-Management-System</title>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/6.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.5.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.5.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.5.0/firebase-database.js"></script>




  <!-- TODO: Add SDKs for Firebase products that you want to use
    https://firebase.google.com/docs/web/setup#config-web-app -->
  <script>

    const firebaseConfig = {
      apiKey: "AIzaSyBh1QQ6tXK0nN_8PWij2sU-TMDEAXEdliI",
      authDomain: "taxi-management-system-55dd3.firebaseapp.com",
      databaseURL: "https://taxi-management-system.firebaseio.com",
      projectId: "taxi-management-system-55dd3",
      storageBucket: "taxi-management-system-55dd3.appspot.com",
      messagingSenderId: "21436343962",
      appId: "1:21436343962:web:6b19df0a78f9ebca376123",
      measurementId: "G-65GRV92XRY"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
  </script>
  <script src="app.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="style.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.28.0/feather.js"> </script>
  <script src="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css"></script>

  <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap4.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWmvgqWSRNTlt2OrIxzr2G1lz7mjJw2X4&callback=initMap"
    async defer></script>
    <script src="particles.js"></script>
    <script src="particles-app.js"></script>
    <script src="featherjs.js"></script>

  <style>
    table.dataTable {
      border-collapse: collapse !important;
    }

    input[type=checkbox].custom-check-search {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;

      height: 1rem;
      width: 1rem;

      border: .1rem solid #C8C9C7;
      border-radius: 50%;
    }

    .completed {
      border-color: #78BE20;
      background-color: #78BE20;
      box-shadow: 0px 0px .2rem .06rem #78BE20;
    }

    input[type=checkbox].custom-check-search:checked {
      background-color: #C8C9C7;
    }

    input[type=checkbox].custom-check-search:hover {
      box-shadow: 0px 0px .2rem .06rem #C8C9C7;
    }

    input[type=checkbox].custom-check-search.complete {
      border-color: #78BE20;
    }

    input[type=checkbox].custom-check-search:checked.complete {
      background-color: #78BE20;
    }

    input[type=checkbox].custom-check-search:hover.complete {
      box-shadow: 0px 0px .2rem .06rem #78BE20;
    }
  </style>
</head>

<body  style="height: 100%; background-color: black">
  <div id="particles-js" >

  
  <div class="container" id="login_div" style="display: none;">
    <div class="row">
      <div class="col-sm-4"></div>
      <div class="col-sm-4" style="margin-top: 10%;">
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" class="form-control" id="email_field" placeholder="Enter email" name="email">
        </div>
        <div class="form-group">
          <label for="pwd">Password:</label>
          <input type="password" class="form-control" id="password_field" placeholder="Enter password" name="pswd">
        </div>
        <div class="text-center">
          <button class="btn btn-primary" onclick="login()">Login</button>
        </div>
      </div>
      <div class="col-sm-4"></div>
    </div>
  </div>

  <div id="content_div" class="container" style="display: none">
    <br><br>
    <div class="card mb-4">
      <div class="card-header text-white bg-dark">
        Control Center
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-lg-9">

          </div>
          <div class="col-lg-3 text-right">
            <div class="row">
              <p id="user_para">Welcome</p>&nbsp&nbsp
              <button class="btn btn-danger" onclick="logout()">Logout</button>
            </div>
          </div>
        </div>

        <div class="container mt-3">
          <br>
          <!-- Nav tabs -->
          <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#dashboard_tab" onclick="initMap();">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#buses_tab">Taxis</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#drivers_tab">Drivers</a>
            </li>
          </ul>

          <!-- Tab panes -->
          <div class="tab-content">
            <div id="dashboard_tab" class="container tab-pane active"><br>
              <h3>Home</h3>
              <div class="container">
                <div class="row">
                  <div class="col-md-12 text-center">
                    <div id="floating_panel" class="card text-info"></div>
                    <div id="map" style="height: 400px; width: 1000px;"></div>
                  </div>
                </div>
              </div>
            </div>

            <div id="buses_tab" class="container tab-pane fade"><br>
              <h3>Taxis</h3>

              <div class="container">
                <!-- <div class="container">
                  <div id="alert_space">
                  </div>


                  <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-10 text-center">
                      <input id="buses-search-field" type="text" oninput="searchBuses();" style="margin-bottom: 4px;"
                        class="form-control form-control" placeholder="Search...">
                    </div>
                    <div class="col-md-1"></div>
                  </div>
                  <br>
                  <div class="row">

                    <div class="col-md-12 ml-4">
                      <button type="button" data-toggle="modal" data-target="#addBusModal" class="btn btn-outline-dark">
                        Add Taxi
                      </button>
                    </div>

                  </div>
                </div> -->


                <div class="row mb-4">
                  <div class="col-md-8 mx-auto">
                    <div class="input-group input-custom-search">
                      <div class="input-group-prepend">
                        <span class="input-group-text"><i class="feather-search"></i></span>
                      </div>

                      <input type="text" class="form-control" placeholder="Search Taxis" id="mySearch"
                        autocomplete="off">

                      <div class="input-group-append">
                        <button type="button" class="btn btn-outline-dark" onclick="$('#clpFilter').collapse('toggle');"
                          data-toggle="tooltip" title="Filters">
                          Filter
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row mb-4 px-2 collapse" id="clpFilter">
                  <div class="col-12">
                    <hr>
                  </div>

                  <div class="col-auto px-5">
                    <label class="control-label d-block">Status</label>
                    <div class="form-group mb-0">
                      <div class="form-check form-check-inline">
                        <input type="checkbox" class="form-check-input position-static custom-check-search"
                          id="allClosed" value="closed" data-toggle="tooltip" title="Filter Inactive" checked
                          autocomplete="off">
                      </div>
                      <div class="form-check form-check-inline">
                        <input type="checkbox" class="form-check-input position-static custom-check-search complete"
                          id="allCompleted" data-toggle="tooltip" title="Filter Active" value="completed" checked
                          autocomplete="off">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row ml-0">

                  <div class="col-md-12 ml-4">
                    <button type="button" data-toggle="modal" data-target="#addBusModal" class="btn btn-outline-dark">
                      Add Taxi
                    </button>
                  </div>

                </div>


                <table id="tblTaxis" class="table table-striped table-hover w-100">
                  <thead>
                    <tr>
                      <th>Status</th>
                      <th>Update</th>
                      <th>Taxi Code</th>
                      <th>Number Plate</th>
                      <th>Number</th>
                      <th>Route</th>
                    </tr>
                  </thead>
                </table>
              </div>
            </div>

            <div id="drivers_tab" class="container tab-pane fade"><br>
              <h3>Drivers</h3>

              <div class="container">

                <div class="container">
                  <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-10 text-center">
                      <input id="drivers-search-field" type="text" oninput="searchDrivers();"
                        style="margin-bottom: 4px;" class="form-control form-control" placeholder="Search...">
                    </div>
                    <div class="col-md-1"></div>
                  </div>
                </div>

                <table id="tblDrivers" class="table table-striped table-hover table  w-100">
                  <thead>
                    <tr>
                      <th></th>
                      <th></th>
                      <th>Id</th>
                      <th>Name</th>
                      <th>Image</th>
                      <th>Type</th>
                    </tr>
                  </thead>
                </table>

              </div>
            </div>


          </div>
        </div>

        <!-- The Modal -->
        <div class="modal fade" id="addBusModal">
          <div class="modal-dialog">
            <div class="modal-content">

              <!-- Modal Header -->
              <div class="modal-header">
                <h4 class="modal-title">Add a new bus</h4>
                <button type="button" class="close" data-dismiss="modal">×</button>
              </div>

              <!-- Modal body -->
              <div class="modal-body">
                <div class="container">
                  <form>
                    <div class="form-group">
                      <label for="inputNumPlate">Number Plate</label>
                      <input type="text" class="form-control" id="inputNumPlate">
                    </div>
                    <div class="form-group">
                      <label for="inputBusNum">Bus Number</label>
                      <input type="text" class="form-control" id="inputBusNum">
                    </div>
                    <div class="form-group">
                      <label for="inputBusRoute">Bus Route</label>
                      <input type="text" id="inputBusRoute" class="form-control">
                    </div>
                  </form>
                </div>
              </div>

              <!-- Modal footer -->
              <div class="modal-footer">
                <button type="button" onclick="addBus();" data-dismiss="modal" class="btn btn-primary">Add new
                  bus</button>
              </div>

            </div>
          </div>
        </div>

        <!--Modal for editing-->
        <div class="modal fade" id="updateTaxiDetails">
          <div class="modal-dialog">
            <div class="modal-content">

              <!-- Modal Header -->
              <div class="modal-header bg-dark">
                <h4 class="modal-title text-white">Update Taxi</h4>
                <button type="button" class="close" data-dismiss="modal">×</button>
              </div>

              <!-- Modal body -->
              <div class="modal-body">
                <div class="container">
                  <div class="row mb-5">
                    <div class="col-md-12">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="customSwitch1">
                        <label class="custom-control-label" for="customSwitch1">Active/De-Activate</label>
                      </div>
                    </div>
                  </div>
                  <form>
                    <div class="form-group">
                      <label for="inputNumPlateToUpdate">Number Plate</label>
                      <input type="text" class="form-control" id="inputNumPlateToUpdate">
                    </div>
                    <div class="form-group">
                      <label for="inputBusNumToUpdate">Taxi Number</label>
                      <input type="text" class="form-control" id="inputBusNumToUpdate">
                    </div>
                    <div class="form-group">
                      <label for="inputBusRouteToUpdate">Taxi Route</label>
                      <input type="text" id="inputBusRouteToUpdate" class="form-control">
                    </div>
                  </form>
                </div>
              </div>

              <!-- Modal footer -->
              <div class="modal-footer">
                <button type="button" onclick="SaveTaxisChanges();" data-dismiss="modal" class="btn btn-dark">Update
                  Taxi
                  Details</button>
              </div>

            </div>
          </div>
        </div>



        <div class="modal fade" id="deleteTaxi">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header bg-dark">
                <h5 class="modal-title text-white">Delete Taxi</h5>

                <button type="button" class="close closeModal" data-dismiss="modal"
                  style="opacity: .7; color: white;">&times;</button>

              </div>
              <div class="modal-body">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-md-12">
                      <p class="text-center h4">Are you sure you want to delete this taxi
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary btn-icon-text" data-dismiss="modal">No</button>
                <button type="button" class="btn btn-success btn-icon-text closeModal" id="closeAsNoShow"><i
                    class="feather-check"></i>Yes</button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal fade" id="deleteDriver">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header bg-dark">
                <h5 class="modal-title text-white">Delete Driver</h5>

                <button type="button" class="close closeModal" data-dismiss="modal"
                  style="opacity: .7; color: white;">&times;</button>

              </div>
              <div class="modal-body">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-md-12">
                      <p class="text-center h4">Are you sure you want to delete this driver
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary btn-icon-text" data-dismiss="modal">No</button>
                <button type="button" class="btn btn-success btn-icon-text closeModal" id="closeAsNoShow"><i
                    class="feather-check"></i>Yes</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card-footer">

      </div>
    </div>

  </div>
  <script src="particles.js"></script>
  <script src="particles-app.js"></script>
  <script src="featherjs.js"></script>

  <script type="text/javascript">
    var taxisTable;
    var driversTable;
    $(document).ready(function () {
      loadDrivers();
      loadTaxis();
      $('[data-toggle="tooltip"]').tooltip();
      $('[data-tooltip="tooltip"]').tooltip();
    });
    //search function
    $.fn.dataTable.ext.search.push(
      function (settings, data, dataIndex) {

        let foundStatus = false;
        if ($('#allCompleted').is(":checked") && data[0] == "active") {
          foundStatus = true;
        } else if ($('#allClosed').is(":checked") && (data[0] == "inactive" || data[0] == "")) {
          foundStatus = true;
        }

        const isNoChecks = (!$('#allCompleted').is(":checked") && !$('#allClosed').is(":checked")) ?
          true : false;

        let searchColumns = [1, 2, 3, 4]
        if (foundStatus) {
          for (i = 0; i < searchColumns.length; i++) {
            let dataString = data[searchColumns[i]].toString().toLowerCase();
            let searchValue = $('#mySearch').val().toLowerCase();

            if (dataString.includes(searchValue)) {
              return true;
            }
          }
        } else if (isNoChecks) {
          return true;
        } else {
          return false;
        }
      }
    );
    taxisTable = $('#tblTaxis').DataTable({
      select: {
        style: 'multi',
        selector: 'td:first-child'
      },
      columnDefs: [{
        data: "status", defaultContent: "",
        orderable: false, targets: 0, className: "text-center",
        render: function (data, type, row) {

          if (type == 'display') {
            return generateStatusData(data);
          }

          return data;
        }
      }, {
        data: "id",
        orderable: false,
        targets: 1, render: function (data, type, row, meta) {
          return `<button type="button"
                    class="btn btn-secondary btn-icon-rounded p-0 align-self-center remove-location-item-button "  data-toggle="modal" data-target="#updateTaxiDetails"
                    data-tooltip="tooltip" title="Upate Taxi Details" onclick="editTaxi(this)" id ='${data}'>
                    Edit
                    </button>`
        },
        width: "1%"
      },

      {
        data: "numberPlate", defaultContent: "", className: 'text-center',
        targets: 2
      },

      {
        data: "taxiCode", defaultContent: "",
        targets: 3, className: 'text-center'
      },
      {
        data: "taxiNumber", defaultContent: "",
        targets: 4, className: 'text-center'
      },
      {
        data: "taxiRoute", defaultContent: "",
        targets: 5, className: 'text-center'
      }
      ],
      select: {
        style: 'single',
      },
      order: [[1, 'desc']],
      lengthMenu: [5, 10, 25, 50],
      pageLength: 25,
      dom: '<"row align-items-center" <"col-auto ml-auto"l> > <"row" <"col-12 table-responsive"t> > <"row" <"col"i><"col-auto ml-auto"p> >',
    });


    driversTable = $('#tblDrivers').DataTable({
      select: {
        style: 'multi',
        selector: 'td:first-child'
      },
      columnDefs: [{
        orderable: false,
        targets: 0, render: function (data, type, row, meta) {
          return `<button type="button"
                    class="btn btn-danger btn-icon-rounded p-0 align-self-center remove-location-item-button" data-toggle="modal" data-target="#deleteDriver"
                    data-toggle="tooltip" title="Update Drivers" onclick="removeLocation(this)" id ='${data}'>
                    Edit
                    </button>`
        },
        width: "1%"
      }, {
        orderable: false,
        targets: 1, render: function (data, type, row, meta) {
          return `<button type="button"
                    class="btn btn-secondary btn-icon-rounded p-0 align-self-center remove-location-item-button"
                    data-tooltip="tooltip" title="Remove location" onclick="removeLocation(this)">
                    Update
                    </button>`
        },
        width: "1%"
      },

      {
        data: "id", defaultContent: "", className: 'text-center',
        targets: 2
      },

      {
        data: "fullName", defaultContent: "",
        targets: 3, className: 'text-center'
      },
      {
        data: "imageUrl", defaultContent: "",
        targets: 4, className: 'text-center'
      },
      {
        data: "userType", defaultContent: "",
        targets: 5, className: 'text-center'
      }
      ],
      select: {
        style: 'single',
      },
      order: [[1, 'desc']],
      lengthMenu: [5, 10, 25, 50],
      pageLength: 25,
      dom: '<"row align-items-center" <"col-auto ml-auto"l> > <"row" <"col-12 table-responsive"t> > <"row" <"col"i><"col-auto ml-auto"p> >',
    });

    function loadDrivers() {
      const users = firebase.firestore().collection("Users");
      users
        .get()
        .then((snapshot) => {
          const data = snapshot.docs.map((doc) => ({
            id: doc.id,
            ...doc.data(),
          }));
          console.log("All data in 'books' collection", data);
          if (data.length > 0) {
            $('#tblDrivers').dataTable().fnAddData(data);
            $('[data-toggle="tooltip"]').tooltip();
          }
          // [ { id: 'glMeZvPpTN1Ah31sKcnj', title: 'The Great Gatsby' } ]
        });
      $('[data-tooltip="tooltip"]').tooltip();
    }
    function loadTaxis() {
      const taxis = firebase.firestore().collection("Taxis");
      taxis
        .get()
        .then((snapshot) => {
          const data = snapshot.docs.map((doc) => ({
            id: doc.id,
            ...doc.data(),
          }));
          console.log("All data in 'books' collection", data);
          if (data.length > 0) {
            $('#tblTaxis').dataTable().fnAddData(data);
            //$('[data-toggle="tooltip"]').tooltip();
          }
          // [ { id: 'glMeZvPpTN1Ah31sKcnj', title: 'The Great Gatsby' } ]
        });
      $('[data-tooltip="tooltip"]').tooltip();
      $('[data-tooltip="tooltip"]').tooltip();
    }
    function generateStatusData(status) {
      debugger;
      switch (status) {
        case "active":
          return 'Active';
          break;

        default:
          return 'Inactive';
          break;
      }

      return null;
    }
    $('#clpFilter input[type="checkbox"]').change(function () {
      taxisTable.draw();
    });

    //search datatable all
    $('#mySearch').keyup(function () {
      taxisTable.search(this.value).draw();
    });
    var idToUpdate;
    function editTaxi(e) {

      var num_plate = document.getElementById("inputNumPlate").value;
      var bus_num = document.getElementById("inputBusNum").value;
      var bus_route = document.getElementById("inputBusRoute").value;
      debugger;
      $("#inputNumPlateToUpdate").val($($($(e).parents('tr')).children()[3]).html());
      $("#inputBusNumToUpdate").val($($($(e).parents('tr')).children()[4]).html());
      $("#inputBusRouteToUpdate").val($($($(e).parents('tr')).children()[5]).html());
      idToUpdate = $(e).attr("id");

    }
    function SaveTaxisChanges() {
      const db= firebase.firestore();
      debugger;
      db.collection("Taxis").doc(idToUpdate).update({
        "numberPlate": $("#inputNumPlateToUpdate").val(),
        "taxiNumber": $("#inputBusNumToUpdate").val(),
        "taxiRoute": $("#inputBusRouteToUpdate").val()
      });
      $("#inputNumPlateToUpdate").val("");
      $("#inputBusNumToUpdate").val("");
      $("#inputBusRouteToUpdate").val("");
      idToUpdate="";
    }
  </script>
  </div>
</body>

</html>